<!DOCTYPE html>
<html>
<head>
	<title> Processamento de imagens em Canvas </title>
	<!comment: MathJax para equações matemáticas em TeX>
	<script type="text/javascript" async
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async>
	</script>
</head>
<body>
	<h1> Notas de aula de Computação Gráfica</h1>
	
	<h2>Leitura, escrita e processamento de imagens com Canvas.</h2>

<h3>Leitura e escrita de imagens com Canvas</h3>

<figure>
	<canvas id="imagemOriginal" width="1632" height="3264"></canvas>
	<canvas id="imagemOutput" width="1632" height="3264"></canvas>
<figcaption>
		Imagem da esquerda: Original. Imagem da direita: Imagem processada.
	</figcaption>
</figure>

<p>
	testandooo...  entender esse onload! Por enquanto estamos com imagens monogromáticas. Atenção: este script
	ainda não foi totalmente testado! ACHEI UM DOS BUGS!!! Ta nos comentários! :)
</p>
<script>

      app.UseCors(builder => builder
.AllowAnyOrigin()
.AllowAnyMethod()
.AllowAnyHeader())

	var canvasOriginal = document.getElementById("imagemOriginal");
	var ctxOriginal = canvasOriginal.getContext("2d");
	
	var canvasOut = document.getElementById("imagemOutput");
	var ctxOutput = canvasOut.getContext("2d");
	
	var imgOriginal = new Image();
	var imgDataOut = new Image();

//It seems that firefox does not allow you to use getImageData(...) unless the source of the canvas is from the same domain, 
//and it does not consider files on your hard drive as being from the same domain as an html document also on your hard drive.	
//https://developpaper.com/explain-how-to-solve-the-cross-domain-problem-of-canvas-image-getimagedata-todataurl/
	
	var imgUrl = "https://cdn.discordapp.com/attachments/420050701411024907/918196098185699368/desenhoICG.jpg";
	//var imgUrl = "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Eiffel_tower_at_Exposition_Universelle%2C_Paris%2C_1889.jpg/800px-Eiffel_tower_at_Exposition_Universelle%2C_Paris%2C_1889.jpg";
   
	imgOriginal.crossOrigin = '';
	imgDataOut.crossOrigin = '';
    imgOriginal.src = imgUrl;
	imgOriginal.onload = function(){
		ctxOriginal.drawImage(imgOriginal, 0, 0);
		ctxOutput.drawImage(imgOriginal, 0, 0);
		//ctxOutput.drawImage(imgOriginal, 50, 50);
		//ctxOutput.drawImage(imgOriginal, 100, 100);
		
		imgDataOut = ctxOriginal.getImageData(0, 0, 20, 20);
		
		// invert colors
		for (let i = 0; i < imgDataOut.data.length; i += 4) {
			imgDataOut.data[i] = 255 - imgDataOut.data[i];
			imgDataOut.data[i+1] = 255 - imgDataOut.data[i+1];
			imgDataOut.data[i+2] = 255 - imgDataOut.data[i+2];
			//imgDataOut.data[i+3] = 255;
		}
		ctxOutput.putImageData(imgDataOut, 0, 0);		
};	    
</script>

<p>
	Tentar esse tutorial: <a href="http://rembound.com/articles/how-to-load-and-draw-images-with-html5-canvas">How to load with html5 Canvas</a>
</p>

</body>
</html>